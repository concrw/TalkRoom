# TALKROOM 개발 가이드

**실행 중심 북클럽 플랫폼 개발 가이드**

---

## 목차

1. [개발 환경 설정](#개발-환경-설정)
2. [프로젝트 구조](#프로젝트-구조)
3. [데이터베이스 설정](#데이터베이스-설정)
4. [주요 기능 개발](#주요-기능-개발)
5. [코딩 컨벤션](#코딩-컨벤션)
6. [트러블슈팅](#트러블슈팅)

---

## 개발 환경 설정

### 1. 필수 요구사항

- Node.js 18 이상
- npm 또는 yarn
- Git
- Supabase 계정

### 2. 프로젝트 클론 및 설치

```bash
# 저장소 클론
git clone <repository-url>
cd TalkRoom

# 의존성 설치
npm install
```

### 3. 환경 변수 설정

`.env` 파일을 루트 디렉토리에 생성:

```env
VITE_SUPABASE_URL=https://your-project.supabase.co
VITE_SUPABASE_PUBLISHABLE_KEY=your_supabase_anon_key
```

Supabase 프로젝트에서 URL과 Anon Key를 복사해서 붙여넣으세요.

### 4. 개발 서버 실행

```bash
npm run dev
```

브라우저에서 http://localhost:8088 접속

### 5. 프로덕션 빌드

```bash
npm run build
npm run preview
```

---

## 프로젝트 구조

```
TalkRoom/
├── public/                 # 정적 파일
│   ├── images/            # 이미지 자산
│   └── lovable-uploads/   # 로고 등
├── src/
│   ├── components/        # React 컴포넌트
│   │   ├── ui/           # shadcn/ui 컴포넌트 (49개)
│   │   ├── BottomNav.tsx
│   │   ├── ProtectedRoute.tsx
│   │   └── ...
│   ├── pages/            # 페이지 컴포넌트 (19개)
│   │   ├── Index.tsx     # 홈/디스커버리
│   │   ├── Auth.tsx      # 로그인/회원가입
│   │   ├── Explore.tsx   # 탐색
│   │   ├── Schedule.tsx  # 일정 관리
│   │   ├── Community.tsx # 커뮤니티
│   │   └── ...
│   ├── hooks/            # Custom Hooks
│   │   ├── useAuth.tsx   # 인증 훅
│   │   └── use-toast.ts  # 토스트 훅
│   ├── integrations/     # Supabase 통합
│   │   └── supabase/
│   │       ├── client.ts # Supabase 클라이언트
│   │       └── types.ts  # DB 타입 정의
│   ├── lib/              # 유틸리티
│   │   └── utils.ts
│   ├── App.tsx           # 앱 루트
│   ├── main.tsx          # 진입점
│   └── index.css         # 전역 스타일
├── supabase/
│   ├── migrations/       # DB 마이그레이션 (27개)
│   └── seed_sample_data.sql # 샘플 데이터
├── .clauderules          # 개발 규칙
└── package.json
```

---

## 데이터베이스 설정

### 주요 테이블

| 테이블 | 설명 |
|--------|------|
| `users` | 사용자 프로필 |
| `talk_rooms` | 토크룸 |
| `room_participants` | 참여자 |
| `voice_sessions` | 음성 세션 |
| `chat_messages` | 실시간 채팅 |
| `training_courses` | 훈련 코스 |
| `daily_logs` | 일일 기록 |
| `feed_posts` | 커뮤니티 피드 |
| `post_likes` | 좋아요 |
| `reviews` | 리뷰 |
| `notifications` | 알림 |
| `room_favorites` | 관심 토크룸 |

### 마이그레이션 적용

Supabase 대시보드에서:
1. Database > Migrations
2. 27개 마이그레이션 파일 순서대로 실행

또는 Supabase CLI 사용:
```bash
# Supabase CLI 설치
npm install -g supabase

# 프로젝트 링크
supabase link --project-ref your-project-ref

# 마이그레이션 적용
supabase db push
```

### 샘플 데이터 삽입

```bash
# Supabase SQL Editor에서 실행
# supabase/seed_sample_data.sql 내용 복사-붙여넣기

# 주의: host_id를 실제 사용자 ID로 변경해야 합니다
```

---

## 주요 기능 개발

### 1. 인증 (Auth)

```typescript
import { useAuth } from "@/hooks/useAuth";

function MyComponent() {
  const { user, loading, signIn, signUp, signOut } = useAuth();

  // 로그인
  const handleLogin = async () => {
    await signIn(email, password);
  };

  // 회원가입
  const handleSignup = async () => {
    await signUp(email, password, name);
  };

  return <div>...</div>;
}
```

### 2. 데이터 조회 (React Query)

```typescript
import { useQuery } from "@tanstack/react-query";
import { supabase } from "@/integrations/supabase/client";

function RoomList() {
  const { data: rooms, isLoading } = useQuery({
    queryKey: ["rooms"],
    queryFn: async () => {
      const { data, error } = await supabase
        .from("talk_rooms")
        .select("*")
        .eq("is_public", true)
        .order("created_at", { ascending: false });

      if (error) throw error;
      return data;
    }
  });

  if (isLoading) return <div>Loading...</div>;

  return (
    <div>
      {rooms?.map(room => (
        <div key={room.id}>{room.title}</div>
      ))}
    </div>
  );
}
```

### 3. 데이터 변경 (Mutation)

```typescript
import { useMutation, useQueryClient } from "@tanstack/react-query";
import { supabase } from "@/integrations/supabase/client";
import { useToast } from "@/hooks/use-toast";

function CreateRoom() {
  const { toast } = useToast();
  const queryClient = useQueryClient();

  const createMutation = useMutation({
    mutationFn: async (roomData) => {
      const { data, error } = await supabase
        .from("talk_rooms")
        .insert([roomData])
        .select()
        .single();

      if (error) throw error;
      return data;
    },
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ["rooms"] });
      toast({ title: "토크룸 생성 완료" });
    },
    onError: (error) => {
      toast({
        title: "생성 실패",
        description: error.message,
        variant: "destructive"
      });
    }
  });

  return <button onClick={() => createMutation.mutate(data)}>생성</button>;
}
```

### 4. 실시간 구독 (Realtime)

```typescript
useEffect(() => {
  const channel = supabase
    .channel("chat-messages")
    .on(
      "postgres_changes",
      {
        event: "INSERT",
        schema: "public",
        table: "chat_messages",
        filter: `room_id=eq.${roomId}`
      },
      (payload) => {
        // 새 메시지 처리
        setMessages(prev => [...prev, payload.new]);
      }
    )
    .subscribe();

  return () => {
    supabase.removeChannel(channel);
  };
}, [roomId]);
```

---

## 코딩 컨벤션

### TypeScript 규칙

1. **strict 모드 준수**
   - any 타입 최소화
   - @ts-ignore 절대 금지
   - 명시적 타입 정의 우선

2. **네이밍 컨벤션**
   - 컴포넌트: PascalCase (예: `RoomDetail.tsx`)
   - 함수/변수: camelCase (예: `fetchRooms`)
   - 상수: UPPER_SNAKE_CASE (예: `MAX_CAPACITY`)

### React 패턴

```typescript
// ✅ Good
export default function Component() {
  const { user } = useAuth();
  const { toast } = useToast();

  const { data, isLoading } = useQuery({
    queryKey: ['key'],
    queryFn: async () => {
      const { data, error } = await supabase.from('table').select('*');
      if (error) throw error;
      return data;
    },
  });

  if (isLoading) return <div>Loading...</div>;

  return <div>...</div>;
}

// ❌ Bad
const Component = () => {
  const [data, setData] = useState(null);

  useEffect(() => {
    // 직접 fetch 호출
  }, []);

  return <div>...</div>;
}
```

### 파일 수정 규칙

1. **Edit 도구 사용** - 전체 재작성 금지
2. **기존 패턴 유지** - 프로젝트 스타일 따르기
3. **최소 변경** - 필요한 부분만 수정

---

## 주요 라우트

| 경로 | 페이지 | 보호 | 설명 |
|------|--------|------|------|
| `/` | Index | ❌ | 홈 (디스커버리) |
| `/auth` | Auth | ❌ | 로그인/회원가입 |
| `/explore` | Explore | ❌ | 탐색 |
| `/schedule` | Schedule | ✅ | 일정 관리 |
| `/community` | Community | ✅ | 커뮤니티 피드 |
| `/profile` | Profile | ✅ | 프로필 |
| `/rooms/:id` | RoomDetail | ❌ | 토크룸 상세 |
| `/rooms/:id/join` | JoinRoom | ✅ | 라이브 토크룸 |
| `/training-course/:roomId` | TrainingCourse | ✅ | 훈련 코스 설계 |
| `/daily/:roomId` | Daily | ✅ | 일일 기록 |

---

## 디자인 시스템

### 컬러 팔레트

```css
--background: #FFFFFF        /* Pure White */
--foreground: #1a1a1a        /* Dark Gray */
--primary: #3B82F6           /* Blue 500 */
--secondary: #6B7280         /* Gray 500 */
--border: #E5E7EB            /* Gray 200 */
--star: #FBBF24              /* Yellow 400 */
```

### 간격 시스템

```css
1: 4px
2: 8px
3: 12px
4: 16px
6: 24px
8: 32px
```

### 타이포그래피

```css
text-xs: 12px
text-sm: 14px
text-base: 16px
text-lg: 18px
text-xl: 20px
```

---

## 트러블슈팅

### 빌드 오류

```bash
# 캐시 정리
rm -rf node_modules package-lock.json
npm install

# 타입 체크
npm run build
```

### Supabase 연결 오류

1. `.env` 파일 확인
2. Supabase 프로젝트 상태 확인
3. API Key 재발급

### 포트 충돌

개발 서버는 8080부터 순차적으로 사용 가능한 포트를 찾습니다.
수동 포트 지정:

```json
// vite.config.ts
server: {
  port: 3000
}
```

### 실시간 구독 안됨

1. Supabase 대시보드 > Database > Replication 확인
2. RLS 정책 확인
3. 채널 구독 코드 검증

---

## 참고 문서

- [프로젝트 종합 문서](TalkRoom_프로젝트_종합문서.md)
- [통합 작업 완료 보고서](통합작업_완료보고서.md)
- [개발 규칙](.clauderules)

---

## 개발 워크플로우

### 1. 기능 개발

```bash
# 기능 브랜치 생성
git checkout -b feature/new-feature

# 개발 및 테스트
npm run dev

# 빌드 확인
npm run build

# 커밋
git add .
git commit -m "feat: add new feature"

# 푸시
git push origin feature/new-feature
```

### 2. 배포 (Vercel)

1. Vercel 계정 연결
2. Git 저장소 import
3. 환경 변수 설정
4. 배포

---

**Happy Coding!**
